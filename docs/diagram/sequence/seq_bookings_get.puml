@startuml
title Bookings Flow: GET /api/bookings
actor Client
participant "«Node.js»\nserver" as Server
participant "«router»\nbookings" as Router
participant "«middleware»\nauth" as AuthMW
participant "«controller»\nbookings" as Ctrl
database "«MongoDB»\nDatabase" as DB

== Api/bookings ==
Client -> Server : GET /api/bookings
activate Server
Server -> Router : router.get('/bookings', protect, getBookings)
activate Router
Router -> AuthMW : protect(req, res, next)
activate AuthMW
AuthMW -> DB : verify JWT / load user
activate DB
DB --> AuthMW : user / ok
deactivate DB
AuthMW --> Router : next()
deactivate AuthMW
Router -> Ctrl : getBookings(req, res)
activate Ctrl
alt role != admin
  Ctrl -> DB : Booking.find({ user:req.user.id })
  activate DB
  DB --> Ctrl : bookings[]
  deactivate DB
  Ctrl --> Client : 200 OK { count, data }
else role == admin
  alt has companyId param
    Ctrl -> DB : Booking.find({ company:req.params.companyId })
    activate DB
    DB --> Ctrl : bookings[]
    deactivate DB
    Ctrl --> Client : 200 OK { count, data }
  else no companyId
    Ctrl -> DB : Booking.find({})
    activate DB
    DB --> Ctrl : bookings[]
    deactivate DB
    Ctrl --> Client : 200 OK { count, data }
  end
end
deactivate Ctrl
deactivate Router
deactivate Server
== Api/bookings ==
@enduml