@startuml
title Companies Flow: GET /api/companies/search/dist
actor Client
participant "«Node.js»\nserver" as Server
participant "«router»\ncompanies" as Router
participant "«middleware»\nauth" as AuthMW
participant "«controller»\ncompanies" as Ctrl
participant "«model»\nCompany" as CompanyModel
database "«MongoDB»\nDatabase" as DB

== Api/companies/Search/Dist ==
Client -> Server : GET /api/companies/search/dist
activate Server
Server -> Router : router.get('/companies/search/dist', protect, getCompaniesbyDistance)
activate Router
Router -> AuthMW : protect(req, res, next)
activate AuthMW
AuthMW -> DB : verify JWT / load user
activate DB
DB --> AuthMW : user / ok
deactivate DB
AuthMW --> Router : next()
deactivate AuthMW
Router -> Ctrl : getCompaniesbyDistance(req, res)
activate Ctrl
Ctrl -> DB : Company.aggregate(geo query)
activate DB
DB --> Ctrl : nearbyCompanies[]
deactivate DB
Ctrl --> Client : 200 OK { data }
deactivate Ctrl
deactivate Router
deactivate Server
== Api/companies/Search/Dist ==
@enduml