@startuml
title Auth Flow: POST /api/auth/login
actor Client
participant "«Node.js»\nserver" as Server
participant "«router»\nauth" as Router
participant "«controller»\nauth" as Ctrl
participant "«model»\nUser" as UserModel
database "«MongoDB»\nDatabase" as DB

== Api/auth/Login ==
Client -> Server : POST /api/auth/login
activate Server
Server -> Router : router.post('/auth/login', login)
deactivate Server
activate Router
Router -> Ctrl : login(req, res)
deactivate Router
activate Ctrl
Ctrl -> Ctrl : extract email, password

alt missing email or password
  Ctrl --> Client : 400 Bad Request { success:false, msg:"Please provide email and password" }
else continue
end

Ctrl -> UserModel : User.findOne({ email }).select('+password')
activate UserModel
UserModel -> DB : query user by email
activate DB
DB --> UserModel : user or null
deactivate DB
UserModel --> Ctrl : user or null
deactivate UserModel

alt user not found
  Ctrl --> Client : 400 Bad Request { success:false, msg:"Invalid credentials" }
  deactivate Router
  deactivate Server
else continue
end

Ctrl -> UserModel : user.matchPassword(password)
activate UserModel
UserModel -> DB : compare hashed password
activate DB
DB --> UserModel : isMatch
deactivate DB
UserModel --> Ctrl : isMatch
deactivate UserModel

alt invalid password
  Ctrl --> Client : 401 Unauthorized { success:false, msg:"Invalid credentials" }
  deactivate Router
  deactivate Server
else continue
end

Ctrl -> UserModel : user.getSignedJwtToken()
activate UserModel
UserModel --> Ctrl : token
deactivate UserModel

Ctrl --> Client : 200 OK { success:true, token }

deactivate Ctrl
deactivate Router
deactivate Server
== Api/auth/Login ==
@enduml
